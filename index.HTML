<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stranger Things: Max's Escape (Audio Edition)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&display=swap');
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        #game-container { position: relative; border: 5px solid #400; box-shadow: 0 0 50px #f00; }
        canvas { display: block; image-rendering: pixelated; }
        #ui { position: absolute; top: 20px; left: 20px; color: #fff; font-family: 'Creepster', cursive; font-size: 28px; text-shadow: 3px 3px #f00; pointer-events: none; z-index: 5; }
        #menu { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: flex; flex-direction: column; justify-content: center; align-items: center; color: #cc0000; font-family: 'Creepster', cursive; z-index: 10; text-align: center; }
        button { padding: 15px 40px; background: #cc0000; color: #fff; border: none; font-family: 'Creepster', cursive; font-size: 25px; cursor: pointer; transition: 0.3s; box-shadow: 0 0 15px #f00; }
        button:hover { background: #ff0000; transform: scale(1.1); }
        .loading { color: white; font-family: sans-serif; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui">DISTÂNCIA: <span id="dist">1500</span>m</div>
    <div id="menu">
        <h1 id="title" style="font-size: 70px; margin: 0;">RUN MAX</h1>
        <p id="loading-msg" class="loading">Carregando dimensões...</p>
        <div id="controls" style="display:none">
            <p style="color: #eee; font-family: sans-serif;">Pressione ESPAÇO para pular</p>
            <button onclick="start()">TOCAR WALKMAN (START)</button>
        </div>
    </div>
    <canvas id="canvas" width="800" height="400"></canvas>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const distEl = document.getElementById('dist');
    const menu = document.getElementById('menu');
    const controls = document.getElementById('controls');
    const loadingMsg = document.getElementById('loading-msg');

    // --- ASSETS (IMAGENS E ÁUDIO) ---
    const assets = {
        background: new Image(),
        max: new Image(),
        vecna: new Image(),
        clock: new Image(),
        vine: new Image(),
        portal: new Image()
    };

    // Áudios
    const bgMusic = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3'); // Placeholder Synthwave
    bgMusic.loop = true;
    bgMusic.volume = 0.5;

    const jumpSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3');
    const loseSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2511/2511-preview.mp3');

    // Fontes das Imagens
    assets.background.src = 'https://i.imgur.com/8QZpYvN.png'; 
    assets.max.src = 'https://i.imgur.com/Y7K2Ym0.png';        
    assets.vecna.src = 'https://i.imgur.com/fA7n6O8.png';      
    assets.clock.src = 'https://i.imgur.com/vH9pQYV.png';      
    assets.vine.src = 'https://i.imgur.com/uGzX6pE.png';       
    assets.portal.src = 'https://i.imgur.com/7S8Y8fP.png';     

    let loadedCount = 0;
    const totalAssets = Object.keys(assets).length;

    Object.values(assets).forEach(img => {
        img.onload = () => {
            loadedCount++;
            if (loadedCount === totalAssets) {
                loadingMsg.style.display = 'none';
                controls.style.display = 'block';
            }
        };
    });

    // --- LÓGICA DO JOGO ---
    let gameActive = false;
    let distance = 1500;
    let frames = 0;
    let obstacles = [];
    let speed = 7;

    const player = { x: 180, y: 280, dy: 0, w: 60, h: 90, jumping: false };
    const vecnaStalker = { x: 20, y: 180, w: 120, h: 180 };

    function spawnObstacle() {
        const isClock = Math.random() > 0.5;
        obstacles.push({
            x: 850,
            y: isClock ? 260 : 280,
            w: isClock ? 50 : 70,
            h: isClock ? 100 : 80,
            img: isClock ? assets.clock : assets.vine
        });
    }

    function update() {
        if (!gameActive) return;

        frames++;
        distance -= 0.5;
        distEl.innerText = Math.max(0, Math.floor(distance));

        player.dy += 0.8;
        player.y += player.dy;
        if (player.y > 280) {
            player.y = 280;
            player.dy = 0;
            player.jumping = false;
        }

        if (frames % 100 === 0) spawnObstacle();

        obstacles.forEach((obs, i) => {
            obs.x -= speed;
            if (player.x < obs.x + obs.w - 15 && player.x + player.w - 15 > obs.x && player.y < obs.y + obs.h - 15 && player.y + player.h > obs.y) {
                endGame(false);
            }
            if (obs.x < -100) obstacles.splice(i, 1);
        });

        if (distance <= 0 && player.x > 700) endGame(true);
    }

    function draw() {
        let bgScroll = (frames * (speed * 0.5)) % canvas.width;
        ctx.drawImage(assets.background, -bgScroll, 0, canvas.width, canvas.height);
        ctx.drawImage(assets.background, canvas.width - bgScroll, 0, canvas.width, canvas.height);

        const vecnaFloat = Math.sin(frames * 0.05) * 15;
        ctx.drawImage(assets.vecna, vecnaStalker.x, vecnaStalker.y + vecnaFloat, vecnaStalker.w, vecnaStalker.h);

        obstacles.forEach(obs => ctx.drawImage(obs.img, obs.x, obs.y, obs.w, obs.h));

        if (distance <= 0) ctx.drawImage(assets.portal, 600, 150, 150, 200);

        ctx.drawImage(assets.max, player.x, player.y, player.w, player.h);

        // Vinheta de perigo
        const v = ctx.createRadialGradient(400, 200, 150, 400, 200, 600);
        v.addColorStop(0, 'transparent');
        v.addColorStop(1, 'rgba(100, 0, 0, 0.4)');
        ctx.fillStyle = v;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }

    function start() {
        gameActive = true;
        distance = 1500;
        obstacles = [];
        player.y = 280;
        frames = 0;
        menu.style.display = 'none';
        
        // Audio Control
        bgMusic.currentTime = 0;
        bgMusic.play().catch(e => console.log("Audio play blocked"));
    }

    function endGame(win) {
        gameActive = false;
        menu.style.display = 'flex';
        document.getElementById('title').innerText = win ? "MAX ESCAPOU!" : "VECNA TE PEGOU";
        
        bgMusic.pause();
        if(!win) loseSound.play();
    }

    window.addEventListener('keydown', (e) => {
        if ((e.code === 'Space' || e.code === 'ArrowUp') && !player.jumping && gameActive) {
            player.dy = -16;
            player.jumping = true;
            jumpSound.currentTime = 0;
            jumpSound.play();
        }
    });

    loop();
</script>
</body>
</html>